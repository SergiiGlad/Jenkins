#!groovy

library identifier: 'my-shared-library@master', retriever: modernSCM(github(repository: 'Jenkins', repoOwner: 'SergiiGlad'))

def gettags

podTemplate(label: podLabel, containers: [
        containerTemplate(name: 'ssh-client', image: 'kroniak/ssh-client:3.6', ttyEnabled: true, command: 'cat')
]) {
  node(podLabel) {
    container('ssh-client') {
      sshagent(credentials: ['git_ssh']) {
        env.GIT_SSH_COMMAND = "ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no"
        sh 'git ls-remote -t -h ssh://git@github.com/sergiiglad/web.git'
      }
    }
  }
}


def getAllGitTags(){
  git url: 'https://github.com/sergiiglad/web.git'
  def getall = sh(returnStdout: true, script: 'git tag')
  return getall.readLines().unique()
}

def getRemote() {
  def gettags
  sshagent(credentials: ['git_ssh']) {
    env.GIT_SSH_COMMAND = "ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no"
    sh 'git ls-remote -t -h ssh://git@github.com/sergiiglad/web.git'
  }
  println gettags
}
